pipeline {
    agent any

    environment {
        DOCKERHUB_TOKEN = credentials('dockerhub-credentials')  // Token for DockerHub
        GITHUB_TOKEN = credentials('github-token')  // Token for GitHub
    }

    stages {
        stage('Checkout SCM') {
            steps {
                script {
                    // Checkout the code from the GitHub repository
                    git url: 'https://github.com/SelimRiahi/test-jenk.git', branch: 'main', credentialsId: 'github-token'
                }
            }
        }

        stage('Build Docker Image') {
            steps {
                script {
                    // Navigate to the 'test' folder where your static API is located
                    dir('test') {
                        // Build the Docker image for the static API
                        sh 'docker build -t selimrh125/static-api .'
                    }
                }
            }
        }

        stage('Push Docker Image to DockerHub') {
            steps {
                script {
                    // Login to DockerHub using the provided credentials
                    sh "echo ${DOCKERHUB_TOKEN} | docker login --username selimrh125 --password-stdin"
                    // Push the Docker image to DockerHub
                    sh 'docker push selimrh125/static-api'
                }
            }
        }
    }
}
